language: haxe

matrix:
  include:
    - haxe: "3.1.3"
      addons:
        apt:
          packages:
            - php-zeroc-ice # use it to install php5 for now
      install:
        # Note that when the haxelib cache exists, haxelib will ask if we want to set versions
        # Use `yes |` to answer that.
        - yes | haxelib install hxcpp
        - yes | haxelib install hxjava
        - yes | haxelib install hxcs
        - haxelib list

    - haxe: "development"
      addons:
        apt:
          packages:
            - php-zeroc-ice # use it to install php5 for now
            - python3
      install:
        # install and rebuild hxcpp
        - haxelib git hxcpp https://github.com/HaxeFoundation/hxcpp.git
        - cd $(haxelib path hxcpp | head -1)tools/hxcpp && haxe compile.hxml
        - cd $(haxelib path hxcpp | head -1)project && neko build.n linux-m64
        - cd $TRAVIS_BUILD_DIR

        # install hxjava and hxcs
        - haxelib git hxjava https://github.com/HaxeFoundation/hxjava.git
        - haxelib git hxcs https://github.com/HaxeFoundation/hxcs.git

        - haxelib list

  allow_failures:
    - haxe: development

script:
  - haxe build-interp.hxml
  - haxe build-neko.hxml && neko bin/HelloWorld.n
  - haxe build-js.hxml && node bin/HelloWorld.js
  - haxe build-java.hxml && java -jar bin/HelloWorld.jar
  - haxe build-php.hxml && php bin/index.php
  - haxe build-cs.hxml -D no-compilation # Missing mono compiler. Just run the haxe compiler for now
  - haxe build-flash.hxml # Flash testing is hard to setup. Just run the haxe compiler for now
  - haxe build-cpp.hxml && ./bin/HelloWorld
  - if [ "${TRAVIS_HAXE_VERSION}" = "development" ]; then haxe build-python.hxml && python3 bin/HelloWorld.py; fi

cache:
  directories:
    - $HOME/haxe/lib